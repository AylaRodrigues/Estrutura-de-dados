// Grupo: Ayla Rodrigues, Douglas Mareli, Sofia Kitaeva
// Exercicio 2 - Estrutura de dados

#include <stdio.h>
#include <stdlib.h>
#include <locale.h>
#include <math.h>

typedef struct arvore{
	int info;
	struct arvore *esq;
	struct arvore *dir;
}arvore;

arvore *LerArvore(FILE *arq, arvore *a){
	char c;
	int num;
	
	fscanf(arq, "%c", &c);
	fscanf(arq, "%d", &num);
	if(num == -1) {
		fscanf(arq, "%c", &c);
		return NULL;
	} else {
		a = (arvore*)malloc(sizeof(arvore));
		a->info = num;
		a->esq = LerArvore(arq, a);
		a->dir = LerArvore(arq, a);
		fscanf(arq, "%c", &c);
		return a;
	}
}

int AlturaArvore(arvore *a)
{
	if (a == NULL)
	{
		return 0;
	}
	else
	{
		int he, hd;
		he=AlturaArvore(a->esq);
		hd=AlturaArvore(a->dir);

		if (he>hd)
		{
			return he+1;
		}
		else
			return hd+1;
	}
}

void ImprimirNivel(arvore *a, int cont, int nivel)//impressao de nivel do no
{
	if (a!= NULL)
	{
		if (cont==nivel)
		{
			printf("%d", a->info);
		}
		else
		{
			ImprimirNivel(a-> esq, cont+1, nivel);
			ImprimirNivel(a-> dir, cont+1, nivel);
		}
	}
}

void ImprimirPreOrdem(arvore *a)//impressao pre ordem
{
	if(a != NULL) 
	{
		printf("%d\n", a->info);
		ImprimirPreOrdem(a->esq);
		ImprimirPreOrdem(a->dir);
	}	
}

void ImprimirEmOrdem(arvore *a)//impressao em ordem
{
	if (a != NULL)
	{
		ImprimirEmOrdem(a->esq);
		printf("%d\n", a->info);
		ImprimirEmOrdem(a->dir);
	}
}

void ImprimirEmLargura(arvore *a, int nivel)//impressao pos ordem
{
	int h = AlturaArvore(a);
	if(nivel != h) {
		ImprimirNivel(a,0,nivel);
		ImprimirEmLargura(a,nivel+1);
	}
}				
		
void ImprimirPosOrdem(arvore *a)//impressao pos ordem
{
	if (a != NULL)
	{
		ImprimirPosOrdem(a->esq);
		ImprimirPosOrdem(a->dir);
		printf("%d\n", a->info);
	}
}		

int Existe(arvore *a, int x)//verificar existencia de um numero x na arvore
{
	if (a==NULL)
	{
		return 0;
	}
	else if (a->info ==x)
	{
		return 1;
	}
	else
	{
		int ret = Existe(a->esq, x);
		if (ret ==1)
		{
			return 1;
			return Existe(a->dir, x);
		}
	}
}

void ImprimirFolhas(arvore *a) {
	if(a != NULL){
		if(a->esq == NULL && a->dir == NULL) {
			printf("%d\n",a->info);
		}
		
		ImprimirFolhas(a->esq);
		ImprimirFolhas(a->dir);
	}
}

arvore *Destruir(arvore *a)//liberar a memoria da arvore e destrui-la
{
	if (a!=NULL)
	{
		a->esq = Destruir(a->esq);
		a->dir = Destruir(a->dir);
		free(a);
	}
	return NULL;
}

int ContarElementos(arvore *a)//contar quantos elementos tem na arvore, tem que colocar recursiva
{
    if (a == NULL)
    {
        return 0;
    } else {
        return ContarElementos(a->esq) + ContarElementos(a->dir) + 1;
    }
}

int VerificaBalanceamento(arvore *a){
	
	int hEsq,hDir;
	
	if(a != NULL) {
		hEsq = AlturaArvore(a->esq);
		hDir = AlturaArvore(a->dir);
		if(abs(hEsq - hDir) == 1 || abs(hEsq - hDir ==0)) {
			return 0 + VerificaBalanceamento(a->esq) + VerificaBalanceamento(a->dir);
		} else {
			return 1;
		}	
	}
}

void VerificarCheia(arvore *a) {
	int h = AlturaArvore(a);
	
	if( h == pow(h, 2) - 1) {
		printf("\nEssa árvore está cheia.\n\n");
	} else {
		printf("\nEssa árvore não está cheia.\n\n");
	}
}

int main() {
	setlocale(LC_ALL, "");
	
	FILE *arq;
	arvore *a;

	arq = fopen("arvore.txt", "rt");
	
	int opcao=0;

	while(opcao!=9)
	{
		printf("O que deseja fazer?\n 1.Ler árvore\n 2.Imprimir árvore\n 3.Verificar existência de um elemento\n 4.Contar número de elementos\n 5.Imprimir os nós da árvore\n 6.Verificar balanceamento da árvore\n 7.Verificar se a árvore é cheia\n 8.Imprimir nivel de um nó\n 9.Sair\n");
		scanf("%d", &opcao);
		printf("\n");
		
		if (opcao==1)//leitua da arvore
		{
			a = LerArvore(arq, a);
		}
		else if(opcao==2)//impressao arvore
		{
			int escolha=0;
			printf("Como deseja que seja feita a impressao da arvore?\n 1.Pre-Ordem\n 2.Em-Ordem\n 3.Pos-Ordem\n 4.Em largura\n");
			scanf("%d", &escolha);
			if (escolha==1)
			{
				printf("----------\n");
				ImprimirPreOrdem(a);
				printf("----------");
				printf("\n\n");
			}
			else if (escolha==2)
			{
				printf("----------\n");
				ImprimirEmOrdem(a);
				printf("----------");
				printf("\n\n");
			}
			else if (escolha ==3)
			{
				printf("----------\n");
				ImprimirPosOrdem(a);
				printf("----------");
				printf("\n\n");
			}
			else
			{
				printf("----------\n");
				ImprimirEmLargura(a);
				printf("----------");
				printf("\n\n");
			}
			
		}
		else if(opcao==3)//verificar existencia
		{
			int x;
			printf("Qual o numero que deseja verificar na arvore?\n");
			scanf("%d", &x);
			x = Existe(a, x);

			if (x==1)
			{
				printf("Esse numero existe na arvore");
			}
			else
			{
				printf("Esse numero nao existe na arvore");
			}
		}
		else if (opcao==4)//contar quant. elementos
		{
			ContarElementos(a);
			printf("A arvore tem %d elementos\n\n", CT);
			CT=0;
		}
		else if(opcao==5)//imprimir nos folhas 
		{
			ImprimirFolhas(a);
		}
		else if(opcao==6)//verificar balanceamento
		{
			int balanc = VerificaBalanceamento(a);
			if(balanc ==0) {
				printf("A árvore está balanceada.\n\n");
			}else {
				printf("A árvore não está balanceada.\n\n");
			}
		}
		else if(opcao==7)//verificar se é cheia
		{
			VerificarCheia(a);
		}
		else if(opcao==8)//imprimir nivel de um no
		{
			
		}

	}
		a = Destruir(a);
		printf("O usuário saiu!\n");
		fclose(arq);
	return 0;
}
